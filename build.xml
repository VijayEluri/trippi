<?xml version="1.0" encoding="UTF-8"?>
<project name="trippi" default="dist" basedir=".">
  <property name="libname" value="trippi" />
  <property name="optimize" value="off" />
  <property name="debug" value="on" />
  <!-- load ${trippi.version} from properties -->
  <loadproperties srcFile="src/java/org/trippi/Trippi.properties" />
    
  <path id="classpath.dist">
  
    <pathelement location="lib/commons-dbcp-1.2.1.jar"/>
    <pathelement location="lib/commons-pool-1.2.jar"/>
    <pathelement location="lib/commons-collections-3.1.jar"/>

    <pathelement location="lib/postgresql-8.1-407.jdbc3.jar"/>

    <pathelement location="lib/mptstore-0.9.jar"/>

    <pathelement location="lib/ojdbc14.jar"/>

    <!-- Kowari libraries --> 
    <pathelement location="lib/driver-1.0.5.jar"/>
    <!-- Kowari 1.1.0
    <pathelement location="lib/content-mbox-base-1.1.0.jar"/>
    <pathelement location="lib/content-mp3-base-1.1.0.jar"/>
    <pathelement location="lib/content-n3-base-1.1.0.jar"/>
    <pathelement location="lib/content-rdfxml-base-1.1.0.jar"/>
    <pathelement location="lib/driver-1.1.0.jar"/>
    <pathelement location="lib/itql-1.1.0.jar"/>
    <pathelement location="lib/jena-base-1.1.0.jar"/>
    <pathelement location="lib/jrdf-base-1.1.0.jar/"/>
    <pathelement location="lib/query-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-file-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-filesystem-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-gis-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-http-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-jar-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-lucene-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-memory-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-nodetype-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-prefix-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-spi-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-store-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-url-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-view-base-1.1.0.jar"/>
    <pathelement location="lib/resolver-xsd-base-1.1.0.jar"/>
    <pathelement location="lib/rules-base-1.1.0.jar"/>
    <pathelement location="lib/server-base-1.1.0.jar"/>
    <pathelement location="lib/server-local-base-1.1.0.jar"/>
    <pathelement location="lib/store-stringpool-memory-base-1.1.0.jar"/>
    <pathelement location="lib/store-stringpool-xa-base-1.1.0.jar"/>
    <pathelement location="lib/store-nodepool-memory-base-1.1.0.jar"/>
    <pathelement location="lib/store-nodepool-xa-base-1.1.0.jar"/>
    <pathelement location="lib/tuples-base-1.1.0.jar/"/>
    <pathelement location="lib/tuples-hybrid-base-1.1.0.jar"/>
    <pathelement location="lib/util-xa-base-1.1.0.jar"/>
    <pathelement location="lib/util-base-1.1.0.jar"/>
    -->
    
    <!-- Libraries required by Kowari --> 
    <!-- Kowari 1.1.0
    <pathelement location="lib/commons-logging-1.0.3.jar"/>
    <pathelement location="lib/connector-1_5.jar"/> -->
    <pathelement location="lib/DateUtils1.jar"/>
    <!--
    <pathelement location="lib/emory-util.jar"/>
    <pathelement location="lib/jotm_carol-1.5.3.jar"/>
    <pathelement location="lib/jotm_iiop_stubs-1.5.3.jar"/>
    <pathelement location="lib/jotm-1.5.3-patched.jar"/>
    <pathelement location="lib/jta-spec_1_0_1.jar"/>
    -->
  
    <!-- Libraries required by Kowari and Trippi -->
    <pathelement location="lib/jena-2.1.jar"/>
    <pathelement location="lib/jrdf-0.3.3.jar"/>
    <!-- Kowari 1.1.0
    <pathelement location="lib/jrdf-0.3.4.jar"/>
    -->
    <pathelement location="lib/mail-1.3.jar"/>   
    <pathelement location="lib/log4j-1.2.8.jar"/>
    <pathelement location="lib/trove-1.0.2.jar"/>
 
    <!-- Sesame libraries --> 
    <pathelement location="lib/openrdf-model.jar"/>
    <pathelement location="lib/openrdf-util.jar"/>
    <pathelement location="lib/sesame.jar"/>
    
    <!-- Libraries required by Sesame -->
    <pathelement location="lib/jakarta-regexp-1.3.jar"/>
    <pathelement location="lib/mysql-connector.jar"/>  
    
    <!-- Libraries required by Sesame and Trippi -->
    <pathelement location="lib/rio.jar"/>
    
    <!-- Libraries only required by Trippi -->
    <pathelement location="lib/javax.servlet-2.3.jar"/>
    <pathelement location="lib/saxon.jar"/>
    <pathelement location="lib/xpp3_min-1.1.3.4.K.jar"/>
    <pathelement location="lib/xmlpull_1_1_3_4a.jar"/>
  </path>
    
    <target name="classes" depends="prep" description="build all java classes into temp/">
        <javac srcdir="src/java" 
               destdir="temp" 
               includes="**" 
               classpathref="classpath.dist" 
               optimize="${optimize}" 
               debug="${debug}" />
    </target>
    <target name="distwar" depends="dist" description="build the web application archive (war) file in dist/">
        <mkdir dir="temp/war" />
        <copy todir="temp/war">
            <fileset dir="src/webapp" />
        </copy>
        <mkdir dir="temp/war/WEB-INF/lib" />
        <copy todir="temp/war/WEB-INF/lib">
            <fileset dir="dist/lib"/>
        </copy>
        <jar jarfile="dist/${libname}.war" basedir="temp/war" />
        <delete dir="temp/war" />
    </target>
    <target name="dist" depends="classes" description="build the entire distribution in dist/">
        <copy todir="temp">
            <fileset dir="src/java">
                <include name="**/*.xml" />
                <include name="**/*.properties" />
            </fileset>
        </copy>
        <mkdir dir="dist/lib" />
        <jar jarfile="dist/lib/${libname}.jar" basedir="temp">
            <manifest>
                <attribute name="Trippi-Version" value="${trippi.version}"/>
                <attribute name="Main-Class" value="org.trippi.Trippi"/>
            </manifest>
        </jar>
        <copy todir="dist/lib">
            <fileset dir="lib">
                <exclude name="javax.servlet-2.3.jar" />
            </fileset>
        </copy>
        <copy todir="dist" file="src/bat/trippi.bat"/>
        <copy todir="dist" file="src/sh/trippi"/>
        <mkdir dir="dist/config" />
        <copy todir="dist/config">
            <fileset dir="src/config" />
        </copy>
        <mkdir dir="dist/samples" />
        <copy todir="dist/samples">
            <fileset dir="src/samples" />
        </copy>
    </target>
    <target name="replay" depends="replayclasses" description="build the kreplay distribution in dist/replay">
        <mkdir dir="dist/replay"/>
        <copy todir="dist/replay" file="src/bat/kreplay.bat"/>
        <copy todir="dist/replay" file="src/sh/kreplay"/>
        <mkdir dir="dist/replay/lib"/>
        <copy todir="dist/replay/lib" file="src/config/log4j-kreplay.xml"/>
        <move file="dist/replay/lib/log4j-kreplay.xml" tofile="dist/replay/lib/log4j.xml"/>
        <copy todir="dist/replay/lib">
            <fileset dir="lib">
                <exclude name="javax.servlet-2.3.jar" />
                <exclude name="mysql-connector.jar"/>  
            </fileset>
        </copy>
        <jar jarfile="dist/replay/kreplay.jar" basedir="temp/replay">
            <manifest>
                <attribute name="Main-Class" value="org.trippi.impl.kowari.replay.KReplay"/>
            </manifest>
        </jar>
    </target>
    <target name="replayclasses" depends="prep" description="build the kreplay classes in temp/replay">
        <mkdir dir="temp/replay"/>
        <javac srcdir="src/java" 
               destdir="temp/replay" 
               includes="org/trippi/impl/kowari/replay/**" 
               classpathref="classpath.dist" 
               optimize="${optimize}" 
               debug="${debug}" />
    </target>
    <target name="doc" depends="prep" description="Build the documentation in dist">
        <mkdir dir="dist/doc"/>
        <copy todir="dist/doc">
            <fileset dir="src/doc"/>
        </copy>
        <javadoc packagenames="org.trippi,org.trippi.nodegraph" 
                 classpathref="classpath.dist" 
                 sourcepath="src/java" 
                 defaultexcludes="yes"
                 destdir="dist/doc/api" 
                 author="true" 
                 version="true" 
                 use="true" 
                 windowtitle="Trippi Javadocs">
            <doctitle><![CDATA[<h1>Trippi Javadocs</h1>]]></doctitle>
<!--            <link href="http://java.sun.com/j2se/1.4.2/docs/api/" /> -->
            <link href="http://jrdf.sourceforge.net/0.3/doc/javadoc/" />
<!--            <link href="http://jena.sourceforge.net/javadoc/" /> -->
<!--            <link href="http://www.kowari.org/api/" /> -->
        </javadoc>
    </target>
  <target name="prep" description="prepare for a build">
      <mkdir dir="temp" />
      <mkdir dir="dist" />
  </target>
  <target name="clean" description="remove all build-generated stuff">
      <delete dir="temp" />
      <delete dir="dist" />
  </target>
</project>

<?xml version="1.0" encoding="UTF-8"?>
<project name="trippi" default="dist" basedir=".">
  <property name="libname" value="trippi" />
  <property name="optimize" value="off" />
  <property name="debug" value="on" />

  <!-- load library paths, etc from build.properties -->
  <loadproperties srcFile="build.properties" />

  <!-- load ${trippi.version} from properties -->
  <loadproperties srcFile="src/java/org/trippi/Trippi.properties" />
    
  <path id="classpath.dist">
    <pathelement location="${lib.activation}"/>
    <pathelement location="${lib.castor}"/>
    <pathelement location="${lib.commons-dbcp}"/>
    <pathelement location="${lib.commons-collections }"/>
    <pathelement location="${lib.commons-dbcp}"/>
    <pathelement location="${lib.commons-pool}"/>
    <pathelement location="${lib.dateutils}"/>
    <pathelement location="${lib.jakarta-regexp}"/>
    <pathelement location="${lib.jena}"/>
    <pathelement location="${lib.jrdf}"/>
    <pathelement location="${lib.kowari}"/>
    <pathelement location="${lib.log4j}"/>
    <pathelement location="${lib.lucene}"/>
    <pathelement location="${lib.mail}"/>
    <pathelement location="${lib.mptstore}"/>
    <pathelement location="${lib.openrdf-model}"/>
    <pathelement location="${lib.openrdf-rio}"/>
    <pathelement location="${lib.openrdf-util}"/>
    <pathelement location="${lib.oracle-jdbc}"/>
    <pathelement location="${lib.postgres-jdbc}"/>
    <pathelement location="${lib.saxon}"/>
    <pathelement location="${lib.servlet-api}"/>
    <pathelement location="${lib.sesame}"/>
    <pathelement location="${lib.trove}"/>
    <pathelement location="${lib.xerces}"/>
    <pathelement location="${lib.xml-apis}"/>
    <pathelement location="${lib.xmlpull}"/>
    <pathelement location="${lib.xpp3}"/>
  </path>
    
    <target name="classes" depends="prep" description="build all java classes into temp/">
        <javac srcdir="src/java" 
               destdir="temp" 
               includes="**" 
               classpathref="classpath.dist" 
               optimize="${optimize}" 
               debug="${debug}" />
    </target>
    <target name="distwar" depends="dist" description="build the web application archive (war) file in dist/">
        <mkdir dir="temp/war" />
        <copy todir="temp/war">
            <fileset dir="src/webapp" />
        </copy>
        <mkdir dir="temp/war/WEB-INF/lib" />
        <copy todir="temp/war/WEB-INF/lib">
            <fileset dir="dist/lib"/>
        </copy>
        <jar jarfile="dist/${libname}.war" basedir="temp/war" />
        <delete dir="temp/war" />
    </target>
    <target name="dist" depends="classes" description="build the entire distribution in dist/">
        <copy todir="temp">
            <fileset dir="src/java">
                <include name="**/*.xml" />
                <include name="**/*.properties" />
            </fileset>
        </copy>
        <mkdir dir="dist/lib" />
        <jar jarfile="dist/lib/${libname}.jar" basedir="temp">
            <manifest>
                <attribute name="Trippi-Version" value="${trippi.version}"/>
                <attribute name="Main-Class" value="org.trippi.Trippi"/>
            </manifest>
        </jar>
        <copy todir="dist/lib">
            <fileset dir="lib">
                <exclude name="javax.servlet-2.3.jar" />
            </fileset>
        </copy>
        <copy todir="dist" file="src/bat/trippi.bat"/>
        <copy todir="dist" file="src/sh/trippi"/>
        <mkdir dir="dist/config" />
        <copy todir="dist/config">
            <fileset dir="src/config" />
        </copy>
        <mkdir dir="dist/samples" />
        <copy todir="dist/samples">
            <fileset dir="src/samples" />
        </copy>
    </target>
    <target name="replay" depends="replayclasses" description="build the kreplay distribution in dist/replay">
        <mkdir dir="dist/replay"/>
        <copy todir="dist/replay" file="src/bat/kreplay.bat"/>
        <copy todir="dist/replay" file="src/sh/kreplay"/>
        <mkdir dir="dist/replay/lib"/>
        <copy todir="dist/replay/lib" file="src/config/log4j-kreplay.xml"/>
        <move file="dist/replay/lib/log4j-kreplay.xml" tofile="dist/replay/lib/log4j.xml"/>
        <copy todir="dist/replay/lib">
            <fileset dir="lib">
                <exclude name="javax.servlet-2.3.jar" />
            </fileset>
        </copy>
        <jar jarfile="dist/replay/kreplay.jar" basedir="temp/replay">
            <manifest>
                <attribute name="Main-Class" value="org.trippi.impl.kowari.replay.KReplay"/>
            </manifest>
        </jar>
    </target>
    <target name="replayclasses" depends="prep" description="build the kreplay classes in temp/replay">
        <mkdir dir="temp/replay"/>
        <javac srcdir="src/java" 
               destdir="temp/replay" 
               includes="org/trippi/impl/kowari/replay/**" 
               classpathref="classpath.dist" 
               optimize="${optimize}" 
               debug="${debug}" />
    </target>
    <target name="doc" depends="prep" description="Build the documentation in dist">
        <mkdir dir="dist/doc"/>
        <copy todir="dist/doc">
            <fileset dir="src/doc"/>
        </copy>
        <javadoc packagenames="org.trippi,org.trippi.nodegraph" 
                 classpathref="classpath.dist" 
                 sourcepath="src/java" 
                 defaultexcludes="yes"
                 destdir="dist/doc/api" 
                 author="true" 
                 version="true" 
                 use="true" 
                 windowtitle="Trippi Javadocs">
            <doctitle><![CDATA[<h1>Trippi Javadocs</h1>]]></doctitle>
<!--            <link href="http://java.sun.com/j2se/1.4.2/docs/api/" /> -->
            <link href="http://jrdf.sourceforge.net/0.3/doc/javadoc/" />
<!--            <link href="http://jena.sourceforge.net/javadoc/" /> -->
<!--            <link href="http://www.kowari.org/api/" /> -->
        </javadoc>
    </target>
  <target name="prep" description="prepare for a build">
      <mkdir dir="temp" />
      <mkdir dir="dist" />
  </target>
  <target name="clean" description="remove all build-generated stuff">
      <delete dir="temp" />
      <delete dir="dist" />
  </target>
</project>
